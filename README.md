# Personal Skill Map - AI-Powered Skill Map Visualization

An interactive web application that generates and visualizes career skill maps using AI. Enter any career path and get a comprehensive skill map showing the progression from beginner to advanced skills.

## Features

### Primary Workflow: Import → Visualize → Export
- **Document Import**: Upload resumes, portfolios, or LinkedIn URLs - AI extracts skills, contact info, bio, education, work experience, and projects automatically. Imported skills are marked as learned.
- **AI-Generated Skill Maps**: Visualize extracted skills or explore any career path. Get comprehensive skill maps generated by GPT-4o-mini.
- **Resume Export**: Generate professional PDF resumes tailored to specific jobs. Just paste a job posting URL for AI-optimized content with automatic impact upgrade, ATS keyword injection, and strength highlighting. Select output language (English, Chinese, Japanese) independent of UI - all content including job titles, education, and projects is automatically translated to the selected language. CJK fonts (Noto Sans SC/JP) ensure proper Chinese/Japanese rendering. Preview the PDF before downloading. Free tier exports include a watermark; Pro/Premium tiers get clean PDFs.
- **Cover Letter Generation**: Toggle "Include Cover Letter" when generating a resume to create personalized cover letters alongside. Features compelling opening hooks, achievement-focused body paragraphs, company-specific connection points, and strong calls to action. Preview both documents in tabbed view and download as a ZIP file.

### Career Exploration
- **Smart Search**: Enter a specific career or describe your preferences (e.g., "I want to work remotely") - AI analyzes your query and suggests matching careers
- **Master Skill Map**: Dashboard visualization combining all your careers into a unified graph with user center node, career clusters, and skill nodes
- **Interactive Visualization**: Explore skill maps with pan, zoom, and click interactions using React Flow
- **Dynamic Center Node**: Career title node automatically resizes based on text length with adaptive font sizing
- **Dynamic Background**: Animated network background with mouse-reactive nodes
- **Game-Like UI**: Skills displayed with levels, progress bars, and category badges
- **User-Owned Maps**: Logged-in users automatically get personalized copies of skill maps with custom titles and progress tracking
- **Editable Profile**: Update your display name directly from the dashboard with inline editing
- **Auto-Save**: All changes to your maps are automatically saved
- **Sharing**: Make maps public with short shareable URLs - others can view and copy your maps
- **AI Chat Assistant**: Natural language chat to modify skill maps - add skills, merge maps, search trending tech
- **Learning Resources**: Click "Start Learning" on any skill to discover courses, tutorials, and documentation from Udemy, Coursera, YouTube, MDN, and more via Tavily search - admin-configurable affiliated links appear first
- **Document Import**: Extract skills, contact info, bio, work experience, and projects from resumes, portfolios, and profiles (PDF, Word, images, URLs) using AI - imported data updates your profile automatically
- **Resume Export**: Generate professional PDF resumes from your skill maps - optionally target specific jobs via URL or title for AI-tailored content
- **Work Experience**: Manage work history in dashboard with add/edit/delete - included in generated resumes
- **Portfolio Projects**: Manage portfolio/worked projects with technologies, URLs, and dates - included in generated resumes
- **Contact Info**: Add phone number and address (city, state, country) to your profile - displayed in resume header
- **Smart Map Merging**: AI-powered merge combining two skill maps with intelligent deduplication
- **Draggable Nodes**: Reposition skills to your preference - positions auto-save and persist
- **Organize Button**: Re-arrange nodes in a neat radial layout with max 6 nodes per ring (auto-triggers after merge)
- **Quick Actions Menu**: 3-dots dropdown on dashboard cards and career page for merge, organize, share, and delete
- **Toast Notifications**: Non-intrusive success/error feedback via react-hot-toast with custom styling
- **Multi-Language Support**: Full internationalization with English, Chinese, and Japanese
- **SEO & GEO Optimized**: Dynamic sitemap, AI crawler-friendly robots.txt (GPTBot, Claude, Perplexity), hreflang tags, Open Graph/Twitter cards, JSON-LD structured data (FAQ, HowTo schemas for AI search engines)
- **Smart Caching**: Redis caching prevents redundant API calls and speeds up repeat queries
- **Persistent Storage**: Generated skill maps are saved to PostgreSQL for future access
- **Education & Credentials**: Track academic history alongside work experience for cleaner resume exports

### Billing & Credits
- **Credit System**: AI operations consume credits tracked per user with full audit trail
- **Free Tier**: New users get 500 credits ($5 worth) on signup, limited to 1 skill map
- **Subscription Tiers**: Pro and Premium tiers with unlimited maps, no watermarks, and monthly credits
- **Stripe Integration**: Secure payments via Stripe Checkout and billing portal
- **Plan Management**: Upgrade/downgrade between tiers with automatic proration - no duplicate subscriptions
- **Billing Dashboard**: Pricing page shows current subscription status, credits balance, and management options

## Tech Stack

- **Framework**: Next.js 15 (App Router) with Turbopack
- **Database**: Neon (Serverless PostgreSQL) with Drizzle ORM
- **Caching**: Upstash Redis (HTTP-based)
- **AI**: OpenAI API (GPT-4o-mini)
- **Payments**: Stripe (subscriptions & one-time purchases)
- **Visualization**: React Flow (@xyflow/react)
- **PDF Generation**: @react-pdf/renderer (client-side)
- **Styling**: Tailwind CSS v4
- **Animation**: Framer Motion
- **i18n**: next-intl (locale-prefixed URLs)
- **Validation**: Zod
- **Package Manager**: pnpm

## Getting Started

### Prerequisites

- Node.js 18+
- pnpm
- Neon PostgreSQL database
- Upstash Redis instance
- OpenAI API key

### Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd ai-skill-tree-website
   ```

2. Install dependencies:
   ```bash
   pnpm install
   ```

3. Set up environment variables:
   ```bash
   cp .env.example .env.local
   ```

4. Fill in your credentials in `.env.local`:
   ```env
   # Neon PostgreSQL
   DATABASE_URL="postgresql://user:password@host/database?sslmode=require"

   # Upstash Redis
   UPSTASH_REDIS_REST_URL="https://your-redis.upstash.io"
   UPSTASH_REDIS_REST_TOKEN="your-token"

   # OpenAI
   OPENAI_API_KEY="sk-..."

   # NextAuth
   NEXTAUTH_URL="http://localhost:3000"
   NEXTAUTH_SECRET="your-secret"

   # Google OAuth
   GOOGLE_CLIENT_ID="..."
   GOOGLE_CLIENT_SECRET="..."

   # Twitter OAuth (optional)
   TWITTER_CLIENT_ID="..."
   TWITTER_CLIENT_SECRET="..."

   # WeChat OAuth (optional - login disabled if not set)
   WECHAT_APP_ID="..."
   WECHAT_APP_SECRET="..."

   # Tavily Web Search (optional - trending tech search disabled if not set)
   TAVILY_API_KEY="tvly-..."

   # App URL (required for Stripe redirects, defaults to production URL)
   NEXT_PUBLIC_APP_URL="http://localhost:3000"  # Use your domain in production

   # Stripe (optional - billing features disabled if not set)
   STRIPE_SECRET_KEY="sk_..."
   NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY="pk_..."
   STRIPE_WEBHOOK_SECRET="whsec_..."  # Get from: stripe listen --forward-to localhost:3000/api/stripe/webhook
   # Create prices in Stripe Dashboard for subscriptions and credit packs
   STRIPE_PRICE_PRO_MONTHLY="price_..."
   STRIPE_PRICE_PRO_YEARLY="price_..."
   STRIPE_PRICE_PREMIUM_MONTHLY="price_..."
   STRIPE_PRICE_PREMIUM_YEARLY="price_..."
   STRIPE_PRICE_CREDITS_500="price_..."
   STRIPE_PRICE_CREDITS_2000="price_..."
   STRIPE_PRICE_CREDITS_5000="price_..."
   ```

5. Apply the database schema:
   ```bash
   pnpm db:migrate
   ```

6. Start the development server:
   ```bash
   pnpm dev
   ```

7. Open [http://localhost:3000](http://localhost:3000) in your browser.

## Project Structure

```
├── app/
│   ├── [locale]/           # Locale-prefixed pages (en, zh, ja)
│   │   ├── (marketing)/
│   │   │   └── page.tsx        # Landing page (Hero, TwoPaths, Workflow, Features, Demo, Stats sections)
│   │   ├── career/
│   │   │   └── [careerId]/
│   │   │       └── page.tsx    # Career detail with skill graph
│   │   ├── dashboard/
│   │   │   └── page.tsx        # User dashboard
│   │   ├── pricing/
│   │   │   └── page.tsx        # Pricing page with Stripe integration
│   │   └── layout.tsx          # Locale layout with providers
│   ├── api/
│   │   ├── ai/
│   │   │   ├── analyze/        # Query analysis (specific vs vague)
│   │   │   ├── chat/           # AI chat for skill map modifications
│   │   │   └── generate/       # AI skill map generation
│   │   ├── career/             # Career CRUD operations
│   │   ├── import/             # Document import (PDF, Word, images, URLs)
│   │   ├── learning/           # Learning resources search
│   │   ├── admin/              # Admin APIs (affiliated links CRUD)
│   │   ├── map/                # User map operations
│   │   ├── resume/             # Resume generation
│   │   └── stripe/             # Stripe billing (checkout, portal, webhook, prices)
│   ├── globals.css             # Tailwind CSS with custom theme
│   ├── sitemap.ts              # Dynamic sitemap with all locales
│   ├── robots.ts               # Robots.txt configuration
│   ├── icon.png                # App icon (192x192)
│   ├── apple-icon.png          # Apple touch icon (180x180)
│   └── favicon.ico             # Browser favicon
├── components/
│   ├── ai-chat/
│   │   ├── AIChatPanel.tsx     # Floating AI chat panel with import
│   │   ├── ChatMessage.tsx     # Chat message display
│   │   ├── ChatInput.tsx       # Text input with send button
│   │   ├── ModificationPreview.tsx # Changes confirmation modal
│   │   └── MergeMapModal.tsx   # Map merge UI
│   ├── import/
│   │   ├── DocumentImportModal.tsx # File/URL import modal
│   │   └── ImportPreview.tsx   # Extracted skills preview
│   ├── learning/
│   │   └── LearningResourcesModal.tsx # Learning resources modal (Tavily + affiliated)
│   ├── resume/
│   │   ├── ResumePDF.tsx       # PDF template with professional styling and watermark
│   │   ├── CoverLetterPDF.tsx  # Cover letter PDF template with localized labels
│   │   ├── ResumeExportModal.tsx # Multi-stage modal with cover letter toggle, tabbed preview, ZIP export
│   │   ├── PDFPreviewPanel.tsx # Inline PDF viewer for resume (SSR-safe)
│   │   ├── CoverLetterPreviewPanel.tsx # Inline PDF viewer for cover letter (SSR-safe)
│   │   ├── PDFDownloadButton.tsx # Dynamic PDF download wrapper (SSR-safe)
│   │   └── pdfFonts.ts         # Centralized font registration and CJK hyphenation
│   ├── dashboard/
│   │   ├── ExperienceEditor.tsx # Work experience management modal
│   │   └── ProjectEditor.tsx    # Portfolio projects management modal
│   ├── layout/
│   │   ├── Header.tsx              # Site header with navigation
│   │   └── SkillTreeBackground.tsx # Animated network background
│   ├── skill-graph/
│   │   ├── SkillNode.tsx       # Custom skill node component
│   │   ├── SkillEdge.tsx       # Custom animated edge
│   │   └── SkillGraph.tsx      # Main graph component
│   ├── seo/
│   │   └── JsonLd.tsx          # JSON-LD structured data components
│   └── ui/
│       ├── GlassPanel.tsx      # Glassmorphism container
│       ├── Icons.tsx           # Reusable SVG icons
│       ├── SearchInput.tsx     # Search input with customizable width
│       ├── DropdownMenu.tsx    # 3-dots action menu
│       ├── ConfirmModal.tsx    # Styled confirmation dialog
│       ├── Toast.tsx           # Toast notifications wrapper
│       └── LanguageSwitcher.tsx # Language dropdown selector
├── i18n/                       # Internationalization config (routing, request)
├── locales/                    # Translation files organized by namespace
│   ├── en/                     # English translations
│   ├── zh/                     # Chinese translations
│   └── ja/                     # Japanese translations
├── lib/
│   ├── db/                     # Database connection & schema
│   ├── mcp/
│   │   └── tavily.ts           # Tavily web search integration
│   ├── ai.ts                   # OpenAI integration (career generation)
│   ├── ai-chat.ts              # AI chat utilities (modifications, merge)
│   ├── ai-document.ts          # Document skill extraction with vision
│   ├── ai-resume.ts            # Resume generation AI functions
│   ├── document-parser.ts      # PDF, Word, image, URL parsing
│   ├── cache.ts                # Redis cache utilities
│   ├── constants.ts            # Centralized app constants
│   └── schemas.ts              # Zod validation schemas
├── public/
│   ├── icon-transparent-bg.png      # App icon (standard)
│   └── large-icon-transparent-bg.png # Large icon for hero
└── package.json
```

## Key Components

### SkillTreeBackground

An animated SVG background with:
- Grid-based node distribution with organic variation
- Network connections between nearby nodes
- Mouse-reactive nodes (attraction and scale effects)
- Configurable via `BACKGROUND_CONFIG` in `lib/constants.ts`

### Header

Fixed navigation header with:
- App logo with white circular background
- Responsive navigation links (configured via `NAV_LINKS` constant)
- Mobile hamburger menu with animated slide-down panel
- Language switcher
- User authentication menu
- Scroll-aware styling (transparent to blur backdrop)

### SearchInput

Flexible search input component with:
- Customizable width via `className` prop
- Loading state with spinner
- Gradient submit button

## Configuration

All configurable values are centralized in `lib/constants.ts`:

```typescript
// Asset paths
ASSETS.ICON              // Standard icon path
ASSETS.ICON_LARGE        // Large icon for hero

// App branding
APP_NAME                 // "Personal Skill Map"

// Routes (centralized route paths)
ROUTES.HOME              // "/"
ROUTES.DASHBOARD         // "/dashboard"
ROUTES.PROFILE           // "/profile"
ROUTES.CAREER            // "/career"

// Header behavior
HEADER_SCROLL_THRESHOLD  // Pixels before header style changes
NAV_LINKS                // Navigation links array for header

// Background animation
BACKGROUND_CONFIG.GRID_CELL_SIZE
BACKGROUND_CONFIG.NODE_SKIP_RATE
BACKGROUND_CONFIG.COLORS
BACKGROUND_CONFIG.MOUSE_INTERACTION_RADIUS
// ... and more

// Hero animation
HERO_ICON_ROTATION_DURATION  // Seconds per rotation

// SEO & GEO (AI Search Engine Optimization)
SITE_URL                     // Base site URL
APP_DESCRIPTION              // Meta description
SEO_CONFIG.organization      // Organization details (foundingDate, languages, expertise)
SEO_CONFIG.software          // App details (version, category, features)
SEO_CONFIG.course            // JSON-LD Course schema defaults
SEO_CONFIG.aiCrawlers        // AI crawler user agents for robots.txt
SEO_CONFIG.disallowedPaths   // Paths to block from crawlers
SEO_CONFIG.faq               // FAQ data for GEO (AI search engines)
SEO_CONFIG.howToSteps        // HowTo steps for process schema
SEO_CONFIG.howToMeta         // HowTo name and description

// AI Chat
AI_CHAT_CONFIG.model         // OpenAI model (gpt-4o-mini)
AI_CHAT_CONFIG.maxTokens     // Token limit (4000)
AI_CHAT_CONFIG.temperature   // Response randomness (0.7)
AI_CHAT_CONFIG.chatHistoryLimit // Messages in context (10)

// User Profile
USER_NAME_MAX_LENGTH         // Max characters for user name (100)

// API Routes (for client-side)
API_ROUTES.AI_CHAT           // /api/ai/chat
API_ROUTES.AI_ANALYZE        // /api/ai/analyze
API_ROUTES.AI_MERGE          // /api/ai/merge
API_ROUTES.USER_GRAPH        // /api/user/graph
API_ROUTES.USER_PROFILE      // /api/user/profile
API_ROUTES.MAP               // /api/map
API_ROUTES.MAP_FORK          // /api/map/fork
API_ROUTES.LEARNING_RESOURCES      // /api/learning/resources
API_ROUTES.ADMIN_AFFILIATED_LINKS  // /api/admin/affiliated-links

// Landing Page
LANDING_PAGE_CONFIG.featuredCareers  // Popular career buttons array
LANDING_PAGE_CONFIG.stats            // Stats section metrics array
LANDING_PAGE_CONFIG.workflowSteps    // How it works steps array
LANDING_PAGE_CONFIG.demo             // Demo preview settings
LANDING_PAGE_CONFIG.animation        // Animation timing config

// Tavily Web Search
TAVILY_CONFIG.apiUrl                    // API endpoint
TAVILY_CONFIG.defaultSearchDepth        // 'basic' | 'advanced'
TAVILY_CONFIG.trendingTech.includeDomains // Trusted domains for tech search
TAVILY_CONFIG.careerSkills.includeDomains // Trusted domains for career search

// Map Merge
MERGE_CONFIG.similarityThreshold        // Threshold for "recommended" maps (0.3)

// Learning Resources
LEARNING_CONFIG.platforms               // Domain groups (courses, video, docs, community)
LEARNING_CONFIG.cacheTtlSeconds         // Redis cache TTL (3600 = 1 hour)
LEARNING_CONFIG.searchDepth             // Tavily search depth ('advanced')
LEARNING_CONFIG.maxResults              // Max web results (10)
LEARNING_CONFIG.descriptionPreviewLength // Description truncation (200)
LEARNING_CONFIG.levelThresholds         // Skill level to difficulty mapping
LEARNING_CONFIG.maxAffiliatedLinks      // Max affiliated links per skill (3)
LEARNING_CONFIG.modal                   // Modal dimensions (maxHeightVh, headerHeightPx)
LEARNING_CONFIG.platformInfo            // Platform display info (name, icon, color)

// Resume Export
RESUME_CONFIG.bioMaxLength              // Max bio length (500)
RESUME_CONFIG.phoneMaxLength            // Max phone length (30)
RESUME_CONFIG.addressCityMaxLength      // Max city length (100)
RESUME_CONFIG.addressStateMaxLength     // Max state length (100)
RESUME_CONFIG.addressCountryMaxLength   // Max country length (100)
RESUME_CONFIG.addressPostalCodeMaxLength // Max postal code length (20)
RESUME_CONFIG.experienceMaxItems        // Max work experiences (10)
RESUME_CONFIG.projectsMaxItems          // Max portfolio projects (10)
RESUME_CONFIG.projectNameMaxLength      // Max project name (100)
RESUME_CONFIG.projectDescriptionMaxLength // Max project description (500)
RESUME_CONFIG.projectUrlMaxLength       // Max project URL (500)
RESUME_CONFIG.projectTechnologiesMaxItems // Max technologies per project (15)
RESUME_CONFIG.pdfMaxProjects            // Max projects in PDF (5)
RESUME_CONFIG.aiModel                   // OpenAI model (gpt-4o-mini)
RESUME_CONFIG.aiMaxTokens               // Resume generation tokens (4000)
RESUME_CONFIG.aiJobAnalysisMaxTokens    // Job analysis tokens (2000)
RESUME_CONFIG.aiOptimizationTemperature // Temperature for experience rewrites (0.6)
RESUME_CONFIG.maxKeywordsToInject       // Max ATS keywords per experience (20)
RESUME_CONFIG.maxSkillsInPrompt         // Max skills in AI prompts (30)
RESUME_CONFIG.previewSkillCategories    // Categories in preview (3)
RESUME_CONFIG.previewSkillsPerCategory  // Skills per category (4)
RESUME_CONFIG.previewHighlightsCount    // Highlights in preview (3)

// PDF Localization (lib/constants.ts)
PDF_LABELS.en                           // English PDF labels
PDF_LABELS.zh                           // Chinese PDF labels
PDF_LABELS.ja                           // Japanese PDF labels
PDF_LABELS[locale].professionalSummary  // Section title for professional summary
PDF_LABELS[locale].footer               // Footer text
PDF_LABELS[locale].footerUrl            // Footer URL
PDF_LABELS[locale].watermarkDraft       // Draft watermark text
PDF_LABELS[locale].monthAbbreviations   // Month abbreviations array

// PDF Font Configuration (lib/constants.ts)
PDF_FONT_CONFIG.notoSansSC              // Chinese font URLs (regular, bold)
PDF_FONT_CONFIG.notoSansJP              // Japanese font URLs (regular, bold)
PDF_FONT_CONFIG.fontFamilies            // Font family names for registration
PDF_FONT_CONFIG.families                // Font family mapping by locale
PDF_FONT_CONFIG.dateLocales             // Locale to date format mapping (en-US, zh-CN, ja-JP)
PDF_FONT_CONFIG.cjkPattern              // CJK Unicode regex for text wrapping

// PDF Style Constants (lib/constants.ts)
PDF_STYLES.colors.text                  // Text color palette (primary, secondary, muted, etc.)
PDF_STYLES.colors.background            // Background colors (white, muted, subtle)
PDF_STYLES.colors.accent                // Accent colors (amber, cyan)
PDF_STYLES.colors.watermark             // Watermark colors (main, sub, draft)
PDF_STYLES.borderRadius                 // Border radius values (sm: 3, md: 4, lg: 8)

// AI Locale Instructions (lib/constants.ts)
AI_LOCALE_INSTRUCTIONS.en               // "Generate all content in English."
AI_LOCALE_INSTRUCTIONS.zh               // "Generate all content in Simplified Chinese."
AI_LOCALE_INSTRUCTIONS.ja               // "Generate all content in Japanese."

// Document Import
DOCUMENT_IMPORT_CONFIG.maxFileSizeBytes           // Max file size (20MB)
DOCUMENT_IMPORT_CONFIG.charsPerToken              // Chars per token for truncation (4)
DOCUMENT_IMPORT_CONFIG.fileTypes                  // Supported file type definitions (pdf, word, text, image)
DOCUMENT_IMPORT_CONFIG.urlTimeout                 // URL fetch timeout (30s)
DOCUMENT_IMPORT_CONFIG.userAgent                  // Bot user agent for URL fetching
DOCUMENT_IMPORT_CONFIG.portfolioDomains           // Domains to detect as portfolio sites
DOCUMENT_IMPORT_CONFIG.aiExtraction.visionModel   // GPT-4o for images
DOCUMENT_IMPORT_CONFIG.aiExtraction.textModel     // gpt-4o-mini for text
DOCUMENT_IMPORT_CONFIG.aiExtraction.minSkills     // Min skills to extract (10)
DOCUMENT_IMPORT_CONFIG.aiExtraction.maxSkills     // Max skills to extract (25)
DOCUMENT_IMPORT_CONFIG.aiExtraction.existingSkillsLimit  // Max existing skills in context (20)
DOCUMENT_IMPORT_CONFIG.preview.confidenceThresholds      // High/medium confidence thresholds
DOCUMENT_IMPORT_CONFIG.preview.maxDisplayedExperiences   // Max work experiences in preview (5)
DOCUMENT_IMPORT_CONFIG.preview.maxDisplayedProjects      // Max projects in preview (3)
DOCUMENT_IMPORT_CONFIG.modal.maxHeightVh                 // Modal max height as viewport % (85)
DOCUMENT_IMPORT_CONFIG.modal.headerHeightPx              // Header height for scroll calc (200)
// Derived constants
SUPPORTED_FILE_ACCEPT                             // HTML file input accept string

// Billing & Subscriptions
BILLING_CONFIG.tiers                              // Subscription tier definitions (free, pro, premium)
BILLING_CONFIG.tiers.free.maxMaps                 // Map limit for free tier (1)
BILLING_CONFIG.tiers.free.hasWatermark            // Watermark on exports (true for free)
BILLING_CONFIG.tiers.pro.monthlyCredits           // Monthly credits for pro (1000)
BILLING_CONFIG.creditCosts                        // Credit costs per operation
BILLING_CONFIG.creditCosts.ai_generate            // Career generation (10 credits)
BILLING_CONFIG.creditCosts.ai_chat                // AI chat (15 credits)
BILLING_CONFIG.creditCosts.resume_generate        // Resume generation (20 credits)
BILLING_CONFIG.signupBonus                        // Initial signup credits (500)
BILLING_CONFIG.creditPacks                        // Credit pack amounts (500, 2000, 5000)
BILLING_CONFIG.stripePrices                       // Stripe price IDs from env vars
BILLING_CONFIG.fallbackPrices                     // Display prices when Stripe unavailable (USD)
```

## API Routes

### POST `/api/ai/analyze`
Analyze a user query to determine if it's a specific career or needs suggestions.
- Specific career → returns `{ type: "specific", career: CareerSuggestion }`
- Vague/lifestyle query → returns `{ type: "suggestions", suggestions: CareerSuggestion[] }`

### POST `/api/ai/generate`
Generate a new skill map for a career.

### POST `/api/ai/chat`
AI-powered chat for skill map modifications. Supports streaming responses.
- Accepts: message, skill map context, chat history, locale
- Returns: AI response with optional skill modifications
- Features: Tavily web search for trending tech, scope guard for off-topic requests

### POST `/api/ai/merge`
AI-powered smart merge of two skill maps.
- Accepts: source/target nodes and edges, career titles, locale
- Returns: Merged nodes, edges, and suggested title
- Requires authentication

### GET `/api/career/[careerId]?locale=en`
Fetch an existing career by its canonical key or UUID.

### GET `/api/career/search?q=engineer`
Search for careers matching a query.

### Document Import API
- `POST /api/import/document` - Upload and parse file (PDF, Word, images)
  - Accepts: multipart/form-data with file, locale, optional existing context
  - Returns: Extracted skills, edges, suggested title, confidence score, phone, address, bio, work experience, projects
  - Uses GPT-4o vision for images, gpt-4o-mini for text documents
- `POST /api/import/url` - Import from URL (LinkedIn, GitHub, etc.)
  - Accepts: URL, locale, optional existing context
  - Returns: Extracted skills, phone, address, bio, work experience, projects with Tavily fallback for blocked pages

### User Maps API
- `GET /api/map/[mapId]` - Fetch map by UUID or share slug
- `PATCH /api/map/[mapId]` - Update map settings
- `DELETE /api/map/[mapId]` - Delete a user's map
- `POST /api/map/fork` - Create map from base career or imported skills
- `POST /api/map/[mapId]/copy` - Copy public map to your account

### User Profile API
- `GET /api/user/profile` - Get user profile (name, bio, phone, address, experience, projects)
- `PATCH /api/user/profile` - Update user profile (name, bio, phone, address, experience, projects)

### Resume API
- `POST /api/resume/generate` - Generate AI-powered resume content
  - Accepts: `{ locale, jobTitle?, jobUrl? }`
  - Returns: profile, optimized experience, resumeContent (with topStrengths, atsKeywordsUsed), jobRequirements, stats
  - Features: Job URL analysis, experience optimization (impact/ATS/clarity), strength highlighting, language selection

### Cover Letter API
- `POST /api/cover-letter/generate` - Generate personalized cover letter
  - Accepts: `{ locale, jobTitle?, jobUrl?, companyUrl? }`
  - Returns: profile, coverLetterContent (greeting, opening, body, closing, signature, keyStrengths, companyConnection)
  - Features: Company website analysis for personalization, multi-language support

### Learning Resources API
- `GET /api/learning/resources` - Search for learning resources
  - Accepts: `skillName` (required), `category`, `level`
  - Returns: `affiliatedLinks[]`, `webResults[]`, `totalCount`
  - Features: Tavily web search, pattern-matched affiliated links from database, Redis caching (1 hour TTL)

### Billing API
- `POST /api/stripe/checkout` - Create Stripe checkout session
  - Accepts: `{ priceId, locale }`
  - For new subscriptions: Returns Stripe checkout URL
  - For upgrades/downgrades: Updates existing subscription via Stripe API and returns `{ upgraded: true, redirectUrl }`
- `POST /api/stripe/portal` - Create Stripe billing portal session
  - Returns: Portal URL for managing subscription
- `POST /api/stripe/webhook` - Stripe webhook handler
  - Handles: subscription.created, subscription.updated, subscription.deleted, subscription.paused, subscription.resumed, invoice.paid, invoice.payment_failed, checkout.session.completed
  - Local testing: `stripe listen --forward-to localhost:3000/api/stripe/webhook`
- `GET /api/stripe/prices` - Fetch prices from Stripe
  - Returns: Subscription and credit pack prices with amounts and currencies
  - Falls back to display prices in `BILLING_CONFIG.fallbackPrices` when unavailable
- `GET /api/user/credits` - Get user's credit balance and history
- `GET /api/user/subscription` - Get user's subscription info and limits
  - Note: `maxMaps` returns `-1` for unlimited tiers (JSON cannot serialize `Infinity`)

### Admin API
- `GET/POST/PUT/DELETE /api/admin/affiliated-links` - CRUD for affiliated links
  - Authenticated admin-only endpoints
  - Pattern-based skill matching via JSONB arrays

## Deployment

This app is optimized for Vercel deployment:

1. Push to GitHub
2. Connect to Vercel
3. Add environment variables in Vercel dashboard
4. Deploy

## License

MIT
